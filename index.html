<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cycling Investment Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #2e8b57;
      --accent: #f4f4f4;
      --text: #333;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--accent);
      color: var(--text);
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 750px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 10px;
    }
    .summary {
      text-align: center;
      font-size: 1em;
      color: #555;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    .input-dollar {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .input-dollar::before {
      content: "$";
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #555;
      font-size: 1em;
    }
    .input-dollar input {
      padding-left: 25px;
      width: 100%;
    }
    .input-full {
      display: inline-block;
      width: 100%;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1em;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background-color: #246b45;
    }

    .faq-card {
      background-color: #fafafa;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 15px;
      margin-bottom: 15px;
      animation: fadeIn 0.6s ease-in-out;
    }
    #output .faq-card:first-child {
      margin-top: 20px;
    }
    .faq-card:nth-child(even) {
      background-color: #f0f0f0;
    }
    .faq-card h3 {
      margin-top: 0;
      font-size: 1.1em;
    }
    .question-icon {
      margin-right: 8px;
      font-size: 1.2em;
      color: var(--primary);
    }

    .highlight {
      font-weight: bold;
      color: #2e8b57;
    }

    .personal { color: #2e8b57; font-weight: bold; }
    .health { color: #1e90ff; font-weight: bold; }
    .total { color: #daa520; font-weight: bold; }

    .formula {
      font-size: 0.85em;
      text-transform: uppercase;
      color: #555;
    }
    .note {
      font-size: 0.9em;
      color: #555;
      margin-top: 10px;
    }
    sup a {
      text-decoration: none;
      color: inherit;
    }
    sup a:hover {
      text-decoration: underline;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    p, li {
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üö¥ Cycling Investment Calculator</h2>
    <p class="summary">
      This tool estimates the economic and health care benefits of investing in cycling infrastructure.
      Enter your investment amount, annual savings per cyclist, and time period to see projected personal savings,
      health care cost reductions, and total returns for regular cyclists.
    </p>

    <label for="investment">Investment Amount:</label>
    <div class="input-dollar">
      <input type="text" id="investment" value="1,500,000" inputmode="numeric">
    </div>

    <label for="savings">Annual Savings per Cyclist:</label>
    <div class="input-dollar">
      <input type="text" id="savings" value="4,000" inputmode="numeric">
    </div>

    <label for="years">Years (for partial calculation):</label>
    <div class="input-full">
      <input type="number" id="years" value="5" min="1">
    </div>

    <button onclick="calculate()">Calculate</button>

    <div id="output"></div>
  </div>

  <script>
    function formatNumberWithCommas(value) {
      const numericValue = value.replace(/\D/g, '');
      if (!numericValue) return '';
      return numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    ['investment', 'savings'].forEach(id => {
      const input = document.getElementById(id);
      input.addEventListener('input', (e) => {
        const formatted = formatNumberWithCommas(e.target.value);
        e.target.value = formatted;
        e.target.setSelectionRange(e.target.value.length, e.target.value.length);
      });
      input.addEventListener('blur', (e) => {
        e.target.value = formatNumberWithCommas(e.target.value);
      });
    });

    function calculate() {
      const investment = parseFloat(document.getElementById('investment').value.replace(/,/g, '')) || 0;
      const savings = parseFloat(document.getElementById('savings').value.replace(/,/g, '')) || 0;
      const years = parseFloat(document.getElementById('years').value) || 0;

      const multiplier = 3;
      const lifetimeYears = 20;

      const cyclistsFinancial = (savings > 0 && years > 0) ? (investment / (savings * years)) : 0;
      const totalCyclistSavings = cyclistsFinancial * savings * years;
      const lifetimeHealthCostReduction = investment * multiplier;
      const annualHealthCostReduction = lifetimeHealthCostReduction / lifetimeYears;
      const periodHealthCostReduction = annualHealthCostReduction * years;
      const totalBenefit = totalCyclistSavings + periodHealthCostReduction;
      const lifetimeCyclistSavings = cyclistsFinancial * savings * lifetimeYears;
      const totalLifetimeBenefit = lifetimeCyclistSavings + lifetimeHealthCostReduction;

      document.getElementById('output').innerHTML = `
        <div class="faq-card">
          <h3><span class="question-icon">üí°</span>How many regular cyclists would the city need to return $${investment.toLocaleString()} in the form of personal savings to regular cyclists?</h3>
          <p><strong>Answer:</strong> If the city invested $${investment.toLocaleString()} and attracted ${Math.round(cyclistsFinancial).toLocaleString()} regular cyclists, each saving $${savings.toLocaleString()} annually, the combined personal savings of those regular cyclists over ${years.toLocaleString()} years would be <span class="highlight">$${totalCyclistSavings.toLocaleString()}</span>.</p>
          <p class="formula"><em>Formula: INVESTMENT √∑ (SAVINGS √ó YEARS) = ${investment.toLocaleString()} √∑ (${savings.toLocaleString()} √ó ${years.toLocaleString()})</em></p>
        </div>

        <div class="faq-card">
          <h3><span class="question-icon">‚ù§Ô∏è</span>The highest quality studies indicate that for every $1 spent on bikelanes, $${multiplier} in health costs are reduced (over ${lifetimeYears} years)<sup><a href="#note1">1</a></sup>. How much would Provincial health care costs reduce over ${years.toLocaleString()} years?</h3>
          <p><strong>Answer:</strong> Over ${years.toLocaleString()} years, the initial investment of $${investment.toLocaleString()} is projected to reduce Provincial health care costs by approximately <span class="highlight">$${periodHealthCostReduction.toLocaleString()}</span>, based on an annual saving of <span class="highlight">$${annualHealthCostReduction.toLocaleString()}</span> and a total lifetime saving of <span class="highlight">$${lifetimeHealthCostReduction.toLocaleString()}</span> over ${lifetimeYears} years.</p>
          <p class="formula"><em>Formula: LIFETIME = INVESTMENT √ó MULTIPLIER; ANNUAL = LIFETIME √∑ LIFETIME_YEARS; PERIOD = ANNUAL √ó YEARS</em></p>
        </div>

        <div class="faq-card">
          <h3><span class="question-icon">üìä</span>What is the total personal financial benefit to regular cyclists + reduction in Provincial health care spending (over ${years.toLocaleString()} years)?</h3>
          <p><strong>Answer:</strong> üìà Total ${years.toLocaleString()}‚Äëyear economic return: <span class="highlight">$${totalBenefit.toLocaleString()}</span></p>
          <ul>
            <li class="personal">Personal financial benefit to regular cyclists: <span class="highlight">$${totalCyclistSavings.toLocaleString()}</span></li>
            <li class="health">Reduction in Provincial health care spending: <span class="highlight">$${periodHealthCostReduction.toLocaleString()}</span></li>
          </ul>
          <p class="formula"><em>Formula: TOTAL = PERSONAL_BENEFIT + PROVINCIAL_HEALTH_CARE_REDUCTION = ${totalCyclistSavings.toLocaleString()} + ${periodHealthCostReduction.toLocaleString()}</em></p>
        </div>

        <div class="faq-card">
          <h3><span class="question-icon">üèÜ</span>What is the total personal financial benefit to regular cyclists + reduction in Provincial health care spending (over ${lifetimeYears} years)?</h3>
          <p><strong>Answer:</strong> üìà Total ${lifetimeYears}‚Äëyear economic return: <span class="highlight">$${totalLifetimeBenefit.toLocaleString()}</span></p>
          <ul>
            <li><strong>Initial investment amount:</strong> <span class="highlight">$${investment.toLocaleString()}</span></li>
            <li class="personal">Personal financial benefit to regular cyclists: <span class="highlight">$${lifetimeCyclistSavings.toLocaleString()}</span></li>
            <li class="health">Reduction in Provincial health care spending: <span class="highlight">$${lifetimeHealthCostReduction.toLocaleString()}</span></li>
          </ul>
          <p class="formula"><em>Formula: TOTAL_LIFETIME = PERSONAL_LIFETIME_BENEFIT + PROVINCIAL_LIFETIME_HEALTH_CARE_REDUCTION = ${lifetimeCyclistSavings.toLocaleString()} + ${lifetimeHealthCostReduction.toLocaleString()}</em></p>
        </div>

        <p class="note" id="note1">
          *Note<sup>1</sup>: The $${multiplier} figure is based on total health care savings over the assumed ${lifetimeYears}‚Äëyear lifetime of the infrastructure, as reported in 
          <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0246419" target="_blank">peer‚Äëreviewed studies</a>. 
          The ${years.toLocaleString()}‚Äëyear figure shown here is a proportional estimate for illustration.*
        </p>
      `;
    }
  </script>
</body>
</html>
