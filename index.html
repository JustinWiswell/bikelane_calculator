<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cycling ROI Calculator</title>
  <style>
    :root {
      --primary: #2e8b57;
      --surplus: #ffc107;
      --thumb: #4caf50;
      --bg: #f9f9f9;
      --text: #222;
      --card: #fff;
      --border: #ddd;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 2rem;
    }

    .container {
      max-width: 600px;
      margin: auto;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    label {
      display: block;
      margin-top: 1.5rem;
      font-weight: 500;
      font-size: 0.95rem;
    }

    input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      font-size: 0.95rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-top: 0.5rem;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      font-size: 0.95rem;
    }

    input[type="range"] {
      width: 100%;
      height: 20px;
      border-radius: 10px;
      background: linear-gradient(to right, var(--primary) 0%, #ccc 0%);
      outline: none;
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--thumb);
      border-radius: 4px;
      cursor: pointer;
      border: none;
    }

    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--thumb);
      border-radius: 4px;
      cursor: pointer;
      border: none;
    }
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.75rem 1rem 1rem 1rem; /* top right bottom left */
  margin: 0.5rem 0 1rem 0;         /* top right bottom left */
}
.card h2 {
  margin-top: 0;
}


    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .card p {
      margin: 0.3rem 0;
      font-size: 0.95rem;
    }

    .highlight {
      font-weight: 600;
      color: var(--primary);
    }
.formula {
  font-size: 14px !important;
  color: #999;
  margin-top: 0.2rem;
  line-height: 1.2;
  font-style: italic;
}






    .citation {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.5rem;
    }

    .citation a {
      color: var(--primary);
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cycling ROI Calculator</h1>

    <label for="investment">Infrastructure Investment ($)</label>
    <input type="text" id="investment" value="1500000" />

    <label for="savings">Annual Savings per Cyclist ($)</label>
    <input type="text" id="savings" value="4000" />

    <div class="slider-label">
      <label for="years">Years of Impact</label>
      <span id="year-label">5 years</span>
    </div>
    <input type="range" id="years" min="1" max="20" value="5" />

    <div id="output"></div>
  </div>

  <script>
    function formatNumberWithCommas(value) {
      const numericValue = value.replace(/\D/g, '');
      return numericValue ? numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',') : '';
    }

    ['investment', 'savings'].forEach(id => {
      const input = document.getElementById(id);
      input.addEventListener('input', (e) => {
        e.target.value = formatNumberWithCommas(e.target.value);
        calculate();
      });
    });

    document.getElementById('years').addEventListener('input', (e) => {
      document.getElementById('year-label').textContent = `${e.target.value} years`;
      calculate();
    });

    function calculate() {
      const investment = parseFloat(document.getElementById('investment').value.replace(/,/g, '')) || 0;
      const savings = parseFloat(document.getElementById('savings').value.replace(/,/g, '')) || 0;
      const years = parseInt(document.getElementById('years').value);

      const breakEvenYears = 5;
      const multiplier = 3;
      const lifetimeYears = 20;

      const cyclistCount = Math.round(investment / (savings * breakEvenYears));
      const totalCyclistSavings = cyclistCount * savings * years;
      const healthCareSavings = (investment * multiplier / lifetimeYears) * years;
      const totalBenefit = totalCyclistSavings + healthCareSavings;
      const netBenefit = totalBenefit - investment;
      const cumulativeReturn = totalBenefit / investment;

      const slider = document.getElementById('years');
      const maxYears = parseInt(slider.max);
      const currentPercent = (years / maxYears) * 100;
      const payoffPercent = (breakEvenYears / maxYears) * 100;
      const sliderWidth = slider.offsetWidth || 300;
      const thumbWidthPx = 20;
      const thumbOffsetPercent = (thumbWidthPx / sliderWidth) * 100;
      const fillEnd = Math.min(currentPercent + thumbOffsetPercent, 100);

      let gradient = '';
      if (years <= breakEvenYears) {
        gradient = `linear-gradient(to right, var(--primary) ${fillEnd}%, #ccc ${fillEnd}%)`;
      } else {
        gradient = `linear-gradient(to right, 
          var(--primary) ${payoffPercent}%, 
          var(--surplus) ${payoffPercent}%, 
          var(--surplus) ${fillEnd}%, 
          #ccc ${fillEnd}%)`;
      }
      slider.style.background = gradient;

      document.getElementById('output').innerHTML = `
        <div class="card">
          <h2>Assumed Cyclists</h2>
          <p><span class="highlight">${cyclistCount.toLocaleString()}</span> regular cyclists needed to break even over ${breakEvenYears} years.</p>
          <p class="formula"><em>Formula: Cyclist Count = Investment ÷ (Annual Savings × ${breakEvenYears})</em></p>
        </div>

        <div class="card">
          <h2>Projected Savings</h2>
          <p>Personal savings: <span class="highlight">$${totalCyclistSavings.toLocaleString()}</span></p>
          <p>Health care savings: <span class="highlight">$${healthCareSavings.toLocaleString()}</span></p>
          <p class="formula"><em>Formula: Personal Savings = Cyclist Count × Annual Savings × Years</em></p>
          <p class="formula"><em>Formula: Health Care Savings = (Investment × ${multiplier} ÷ ${lifetimeYears}) × Years</em></p>
          <p class="citation">
            <small>
              *Based on findings from the 
              <a href="https://itdp.org/publication/the-case-for-cycling-infrastructure-investments/" target="_blank">CyclingMax Tool report</a> by ITDP and the World Bank, and 
              <a href="https://cyclingmagazine.ca/sections/healthnutrition/for-these-canadian-cities-the-health-benefits-of-cycling-infrastructure-significantly-outweighed-the-cost-of-new-bike-lanes/" target="_blank">Simon Fraser University’s study</a> on Canadian cities.
            </small>
          </p>
        </div>

        <div class="card">
          <h2>Economic Return</h2>
          <p>Total benefit: <span class="highlight">$${totalBenefit.toLocaleString()}</span></p>
                      <p>Net value: <span class="highlight">${netBenefit > 0 ? `$${netBenefit.toLocaleString()}` : '—'}</span></p>
          <p>Return: <span class="highlight">${cumulativeReturn.toFixed(2)}x</span></p>
          <p class="formula"><em>Formula: Total Benefit = Personal Savings + Health Care Savings</em></p>
          <p class="formula"><em>Formula: Net Value = Total Benefit − Investment</em></p>
          <p class="formula"><em>Formula: Return = Total Benefit ÷ Investment</em></p>
        </div>
      `;
    }

    window.addEventListener('DOMContentLoaded', () => {
      calculate();
    });
  </script>
</body>
</html>
