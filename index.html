<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cycling Investment Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #2e8b57;
      --accent: #f4f4f4;
      --text: #333;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--accent);
      color: var(--text);
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 750px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 10px;
    }
    .summary {
      text-align: center;
      font-size: 1em;
      color: #555;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    .input-dollar {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .input-dollar::before {
      content: "$";
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #555;
      font-size: 1em;
    }
    .input-dollar input {
      padding-left: 25px;
      width: 100%;
    }
    .input-full {
      display: inline-block;
      width: 100%;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1em;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background-color: #246b45;
    }

    .faq-card {
      background-color: #fafafa;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 15px;
      margin-bottom: 15px;
      animation: fadeIn 0.6s ease-in-out;
    }
    #output .faq-card:first-child {
      margin-top: 20px;
    }
    .faq-card:nth-child(even) {
      background-color: #f0f0f0;
    }
    .faq-card h3 {
      margin-top: 0;
      font-size: 1.1em;
    }
    .question-icon {
      margin-right: 8px;
      font-size: 1.2em;
      color: var(--primary);
    }

    .highlight {
      font-weight: bold;
      color: #2e8b57;
    }

    .personal { color: #2e8b57; font-weight: bold; }
    .health { color: #1e90ff; font-weight: bold; }
    .total { color: #daa520; font-weight: bold; }

    .formula {
      font-size: 0.85em;
      text-transform: uppercase;
      color: #555;
    }
.pnl-block {
  margin-top: 10px;
}

.pnl-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
  flex-wrap: wrap;
}

.pnl-row .label {
  font-weight: bold;
  flex: 1 1 60%;
}

.pnl-row .value {
  text-align: right;
  flex: 1 1 40%;
  font-weight: bold;
}

@media screen and (max-width: 480px) {
  .pnl-row {
    flex-direction: column;
    align-items: flex-start;
  }

  .pnl-row .value {
    text-align: left;
    margin-top: 4px;
  }
  .pnl-row:first-child {
  border-top: 2px solid #ccc;
}
}

.responsive-table {
  width: 100%;
  overflow-x: auto;
}

.responsive-table table {
  width: 100%;
  border-collapse: collapse;
}

.responsive-table td {
  padding: 8px;
  vertical-align: top;
}

@media screen and (max-width: 480px) {
  .responsive-table td {
    display: block;
    width: 100%;
    text-align: left;
    padding: 6px 0;
  }

  .responsive-table tr {
    display: block;
    margin-bottom: 12px;
    border-bottom: 1px solid #ccc;
  }
}
.label {
  font-weight: bold;
}
.value {
  text-align: right;
  font-weight: bold;
}
.highlight {
  color: #2e8b57;
}

    .note {
      font-size: 0.9em;
      color: #555;
      margin-top: 10px;
    }
    sup a {
      text-decoration: none;
      color: inherit;
    }
    sup a:hover {
      text-decoration: underline;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    p, li {
      line-height: 1.5;
    }

  </style>
</head>
<body>
  <div class="container">
    <h2>üö¥ Cycling Investment Calculator</h2>
    <p class="summary">
      This tool estimates the economic and health care benefits of investing in cycling infrastructure.
      Enter your investment amount and annual savings per cyclist, then use the slider to explore how benefits scale over time.
    </p>

    <label for="investment">Investment Amount:</label>
    <div class="input-dollar">
      <input type="text" id="investment" value="1,500,000" inputmode="numeric">
    </div>

    <label for="savings">Annual Savings per Cyclist:</label>
    <div class="input-dollar">
      <input type="text" id="savings" value="4,000" inputmode="numeric">
    </div>

    <label for="years">Select Timeframe (Years):</label>
    <input type="range" id="years" min="1" max="20" value="5" oninput="updateSliderLabel(this.value)">
    <span id="year-label">5 years</span>

    <div id="output"></div>
  </div>

<script>
  function formatNumberWithCommas(value) {
    const numericValue = value.replace(/\D/g, '');
    if (!numericValue) return '';
    return numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  ['investment', 'savings'].forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener('input', (e) => {
      const formatted = formatNumberWithCommas(e.target.value);
      e.target.value = formatted;
      e.target.setSelectionRange(e.target.value.length, e.target.value.length);
      calculate();
    });
    input.addEventListener('blur', (e) => {
      e.target.value = formatNumberWithCommas(e.target.value);
    });
  });

  function updateSliderLabel(value) {
    document.getElementById('year-label').textContent = `${value} years`;
    calculate();
  }

  function calculate() {
    const investment = parseFloat(document.getElementById('investment').value.replace(/,/g, '')) || 0;
    const savings = parseFloat(document.getElementById('savings').value.replace(/,/g, '')) || 0;
    const years = parseFloat(document.getElementById('years').value) || 0;

    const multiplier = 3;
    const lifetimeYears = 20;
    const breakEvenYears = 5;

    const cyclistCount = Math.round(investment / (savings * breakEvenYears));
    const totalCyclistSavings = cyclistCount * savings * years;
    const lifetimeHealthCostReduction = investment * multiplier;
    const annualHealthCostReduction = lifetimeHealthCostReduction / lifetimeYears;
    const periodHealthCostReduction = annualHealthCostReduction * years;
    const totalBenefit = totalCyclistSavings + periodHealthCostReduction;
    const netBenefit = totalBenefit - investment;
    const cumulativeReturn = totalBenefit / investment;
    const perDollarImpact = totalBenefit / investment;
    const showNetValue = netBenefit > 0;

    // üé® Dynamic slider gradient if ROI > 1
    const slider = document.getElementById('years');
    if (cumulativeReturn > 1) {
      const percent = Math.min((cumulativeReturn / 5) * 100, 100);
      slider.style.background = `linear-gradient(to right, #2e8b57 ${percent}%, #ccc ${percent}%)`;
    } else {
      slider.style.background = '#ccc';
    }

    document.getElementById('output').innerHTML = `
<div class="faq-card">
  <h3><span class="question-icon">üí°</span>How many cyclists are assumed in this model?</h3>
  <p><strong>Answer:</strong> This model assumes the city attracts <span class="highlight">${cyclistCount.toLocaleString()}</span> regular cyclists. That‚Äôs the number needed to break even on a <span class="highlight">$${investment.toLocaleString()}</span> investment over <span class="highlight">${breakEvenYears}</span> years, with each cyclist saving <span class="highlight">$${savings.toLocaleString()}</span> annually.</p>
  
  <p>This fixed cyclist count is used to calculate cumulative savings across all timeframes selected below.</p>

  <p><strong>Why it‚Äôs useful:</strong> This break-even cyclist count gives cities a clear planning target. If ${cyclistCount} regular riders are sustained over ${breakEvenYears} years, the investment pays for itself. It serves as a conservative benchmark based on direct economic savings per rider.</p>

  <p class="formula"><em>Formula: Cyclist Count = Investment √∑ (Annual Savings √ó ${breakEvenYears})</em></p>
</div>






   <div class="faq-card">
  <h3><span class="question-icon">‚ù§Ô∏è</span>How much could health care costs decrease over your selected timeframe?</h3>
  <p><strong>Answer:</strong> Beyond individual savings, cycling infrastructure also drives long-term reductions in health care costs. These benefits are modeled using a conservative multiplier based on peer-reviewed studies.</p>

  <p>Over <span class="highlight">${years.toLocaleString()}</span> years, an initial investment of <span class="highlight">$${investment.toLocaleString()}</span> is projected to reduce health care costs by <span class="highlight">$${periodHealthCostReduction.toLocaleString()}</span>, based on a long-term return of <span class="highlight">$${multiplier}</span> per $1 invested<sup><a href="#note1">1</a></sup>.</p>

  <p class="formula"><em>Formula: Lifetime Savings = Investment √ó Multiplier</em></p>
  <p class="formula"><em>Formula: Annual Savings = Lifetime Savings √∑ ${lifetimeYears}</em></p>
  <p class="formula"><em>Formula: Period Savings = Annual Savings √ó ${years}</em></p>
</div>


      <div class="faq-card">
        <h3><span class="question-icon">üèÜ</span>What is the economic return on cycling infrastructure over ${years} years?</h3>
        <div class="pnl-block">
          <div class="pnl-row">
            <span class="label">Initial Investment</span>
            <span class="value">$${investment.toLocaleString()}</span>
          </div>
          <div class="pnl-row">
            <span class="label">Cyclist Savings</span>
            <span class="value highlight">$${totalCyclistSavings.toLocaleString()}</span>
          </div>
          <div class="pnl-row">
            <span class="label">Health Care Savings</span>
            <span class="value highlight">$${periodHealthCostReduction.toLocaleString()}</span>
          </div>
          <div class="pnl-row">
            <span class="label">Total Benefit</span>
            <span class="value highlight">$${totalBenefit.toLocaleString()}</span>
          </div>
          ${showNetValue ? `
            <div class="pnl-row">
              <span class="label">Net Value Accrued</span>
              <span class="value highlight">$${netBenefit.toLocaleString()}</span>
            </div>
          ` : `
            <div class="pnl-row">
              <span class="label">Net Value Accrued</span>
              <span class="value highlight">‚Äî</span>
            </div>
          `}
          <div class="pnl-row">
            <span class="label">Cumulative Return to Date</span>
            <span class="value highlight">${cumulativeReturn.toFixed(2)}x</span>
          </div>
          <div class="pnl-row">
            <span class="label">Per-Dollar Impact</span>
            <span class="value highlight">$${perDollarImpact.toFixed(1)} per $1 invested</span>
          </div>
        </div>
        <p class="formula"><em>Formula: Cyclist Savings = Cyclist Count √ó Annual Savings √ó Years</em></p>
        <p class="formula"><em>Formula: Total Benefit = Cyclist Savings + Health Care Savings</em></p>
        <p class="formula"><em>Formula: Net Value = Total Benefit ‚àí Investment</em></p>
        <p class="formula"><em>Formula: Cumulative Return = Total Benefit √∑ Investment</em></p>
        <p class="formula"><em>Formula: Per-Dollar Impact = Total Benefit √∑ Investment</em></p>
      </div>

      <p class="note" id="note1">
        *Note<sup>1</sup>: The <span class="highlight">$${multiplier}</span> figure is based on total health care savings over a <span class="highlight">${lifetimeYears}-year</span> infrastructure lifespan, as reported in 
        <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0246419" target="_blank">peer‚Äëreviewed studies</a>.  
        This reflects an <strong>annualized health care cost reduction of $225 per $1 million invested</strong>.  
        The savings shown here are scaled proportionally to your selected timeframe for illustration.*
      </p>
      <p class="note" id="note2">
        *Note<sup>2</sup>: Infrastructure investments typically yield modest returns in early years, with benefits compounding over time due to sustained behavioral adoption, health improvements, and long-term cost avoidance. See 
        <a href="https://www.sciencedirect.com/science/article/pii/S2214140518301485" target="_blank">economic modeling of active transport investments</a> for more.*
      </p>
    `;
  }

  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('years').value = 5;
    updateSliderLabel(5);
  });
</script>




</body>
</html>
